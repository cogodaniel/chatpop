[entrada-chatpop]
exten => 8888,1,Answer()
exten => 8888,n,Goto(entrar-menu,s,1)


;-----------------INICIO
[entrar-menu]
exten => s,1,Answer()
exten => s,n,Playback(menu-acesso-1)
exten => s,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => s,n,AGI(insere_sistema.py,${CALLERID(num)},${PIN})
exten => s,n,Set(SALA=1)
exten => s,n,AGI(insere_banco_sala.py,${CALLERID(num)},${PIN},${SALA},${CHANNEL})

;----VERIFICA SE ESTA BLOQUEADO
exten => s,n,AGI(verifica_bloqueio.py,${CALLERID(num)},${PIN})
exten => s,n,NoOp(Valor de BLOQUEIO = ${BLOQUEIO})
exten => s,n,GotoIf($["${BLOQUEIO}" = "100"]?bloqueado:n_bloqueado)

exten => s,n(bloqueado),NoOp(USUARIO BLOQUEADO)
exten => s,n,Hangup()

exten => s,n(n_bloqueado),NoOp(USUARIO NAO BLOQUEADO)
exten => s,n,Goto(verifica-mudo-supervisor,s,1)



;----VERIFICA SE ESTA COM MUDO DO SUPERVISOR HABILITADO
[verifica-mudo-supervisor]
exten => s,1,NoOp(VERIFICA SE PARTICIPANTE ESTA MUTADO PELO SUPERVISOR)
;-------
;exten => s,n,Set(SALA=1)
exten => s,n,Goto(entrar-sala,s,1)


;----ENTRAR NA SALA
[entrar-sala]
exten => s,1,AGI(consulta_sala.py,${CALLERID(num)},${PIN})
exten => s,n,Set(SALA=${SALA_ATUAL})
exten => s,n,NoOp(ENTRANDO NA SALA ${SALA})
exten => s,n,ConfBridge(${SALA},${SALA},default_user,sample_user_menu) ; ==== ENTRANDO NA SALA COM O CONFBRIDGE
exten => s,n,Goto(trocar-sala,s,1)


; ===========================
; ==== SAIR DA SALA ========
exten => h,1,Goto(sair-chatpop,s,1)
; ===========================


;----SAIR DA SALA
[sair-chatpop]
exten => s,1,NoOp(SAINDO DO CHATPOP)
exten => s,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => s,n,Set(SAIR=SAIR)
exten => s,n,AGI(insere_banco_sala.py,${CALLERID(num)},${PIN},${SAIR},${CHANNEL})
exten => s,n,AGI(remove_mudo_usuario.py,${CALLERID(num)},${PIN})




;----VOLTAR PARA SALA
[retorna-sala]
exten => s,1,NoOp(VOLTANDO PARA A SALA)
exten => s,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => s,n,AGI(consulta_sala.py,${CALLERID(num)},${PIN})
exten => s,n,AGI(digitos_para_audio.py,${SALA_ATUAL})
exten => s,n,Playback(retornando_sala&${DIGITOS})
exten => s,n,ConfBridge(${SALA_ATUAL},${SALA_ATUAL},default_user,sample_user_menu)



;----OPÇÃO 1------------------------------------------------------------------------------
[consulta-pin]
exten => s,1,NoOp(CONSULTA PIN)
exten => s,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => s,n,AGI(digitos_para_audio.py,${PIN})
exten => s,n,NoOp(${DIGITOS})
exten => s,n,Playback(seu_cod_pin&${DIGITOS})
; ---- PERGUNTAR SE QUER OUVIR NOVAMENTE
exten => s,n,Goto(retorna-sala,s,1)


; ===========================
; ==== SAIR DA SALA ========
exten => h,1,Goto(sair-chatpop,s,1)
; ===========================



;----OPÇÃO 2------------------------------------------------------------------------------
; Conhecer Participantes
; 1 - Ouvir Numero de Particpantes da sala
; 2 - Ouvir Saudacao dos participantes da sala
; 3 - Convidar particpante da sala 
[participantes]
exten => s,1,NoOp(CONHECER PARTICIPANTES)
exten => s,n,Background(beep) ;--------------TROCAR POR MENU------------------------
exten => s,n,WaitExten(10)


exten => 1,1,Goto(num-participantes,s,1)
exten => 2,1,Goto(ouvir-saudacao-participantes,s,1)
exten => 3,1,Goto(convidar-participante,s,1)

; ==== VOLTAR A SALA
exten => 0,1,NoOp(VOLTAR PARA SALA)
exten => 0,n,Goto(retorna-sala,s,1)

[num-participantes]
exten => s,1,NoOp(RETORNA NUMERO DE PARTICIPANTES)
exten => s,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => s,n,AGI(retorna_sala.py,${CALLERID(num)},${PIN})
exten => s,n,AGI(num_participantes_sala.py,${SALA_ATUAL})
exten => s,n,AGI(digitos_para_audio.py,${NUM_PARTICIPANTES})
exten => s,n,Playback(numero_usuarios&e&${DIGITOS})
exten => s,n,Goto(participantes,s,1)


;----OPÇÃO 3------------------------------------------------------------------------------
; Torpedo
; 1 - Gravar Torpedo
; 2 - Ouvir Saudacao

;----OPÇÃO 4------------------------------------------------------------------------------
; Saudacao
; 1 - Gravar Saudação
; 2 - Ouvir Saudação
; 3 - Excluir Saudacao
[saudacao]
exten => s,1,NoOp(SAUDACAO)
exten => s,n,Background(abertura_saudacao)
exten => s,n,WaitExten(5)


exten => 1,1,Goto(gravar-saudacao,s,1)
exten => 2,1,Goto(ouvir-saudacao,s,1)
exten => 3,1,Goto(excluir-saudacao,s,1)

; ==== VOLTAR A SALA
exten => 0,1,NoOp(VOLTAR PARA SALA)
exten => 0,n,Goto(retorna-sala,s,1)


; === GRAVAR SAUDACAO
[gravar-saudacao]
exten => s,1,NoOp(GRAVA SAUDACAO)
exten => s,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => s,n,AGI(cria_saudacao.py,${CALLERID(num)},${PIN})
exten => s,n,AGI(grava_saudacao.py,${SAUDACAO})
exten => s,n,Playback(saudacao_gracada_sucesso)
exten => s,n,Goto(saudacao,s,1)

; === OUVIR SAUDACAO
[ouvir-saudacao]
exten => s,1,NoOp(OUVIR SAUDACAO)
exten => s,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => s,n,AGI(retorna_saudacao.py,${CALLERID(num)},${PIN})
exten => s,n,Playback(saudacao/${ARQUIVO_SAUDACAO})
exten => s,n,Goto(saudacao,s,1)

; === EXCLUIR SAUDACAO
[excluir-saudacao]
exten => s,1,NoOp(EXCLUIR SAUDACAO)
exten => s,n,Background(excluir_saudacao)
exten => s,n,WaitExten(10)

exten => 1,1,NoOp(EXCLUIR SAUDACAO - CONFIRMAR)
exten => 1,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => 1,n,AGI(retorna_saudacao.py,${CALLERID(num)},${PIN})
exten => 1,n,AGI(deleta_saudacao.py,${ARQUIVO_SAUDACAO})
exten => 1,n,AGI(remove_saudacao.py,${CALLERID(num)},${PIN},${ARQUIVO_SAUDACAO})
exten => 1,n,Playback(excluir_saudacao_sucesso)
exten => 1,n,Goto(saudacao,s,1)

exten => 2,1,NoOp(RETONAR AO MENU ANTERIOR)
exten => 2,n,Goto(saudacao,s,1)






;----OPÇÃO 5------------------------------------------------------------------------------
[mudo]
exten => s,1,NoOp(ATIVAR/DESATIVAR MUDO)
exten => s,n,AGI(numero_para_pin.py,${CALLERID(num)})
;exten => s,n,AGI(verifica_mudo_supervidor.py,${CALLERID(num)},${PIN})
exten => s,n,AGI(verifica_mudo_usuario.py,${CALLERID(num)},${PIN}) ; ====== VERIFICA MUDO SUPERVISOR
exten => s,n,GotoIf($["${MUDO_USUARIO}" = "100"]?desabilitar_mudo:habilitar_mudo) ;======= VERIFICA MUDO USUARIO


; ==== CASO JA ESTEJA REMOVE
exten => s,n(desabilitar_mudo),NoOp(DESABILITAR MUDO)
exten => s,n,AGI(remove_mudo_usuario.py,${CALLERID(num)},${PIN})
; ==== PEGA SALA E CANAL
exten => s,n,AGI(consulta_sala.py,${CALLERID(num)},${PIN})
exten => s,n,AGI(retorna_canal.py,${CALLERID(num)},${PIN})
; ==== DESATIVA MUDO NO CONFBRIDGE
exten => s,n,AGI(desmuta_canal.py,${SALA_ATUAL},${CANAL})
; ==== PLAYBACK
exten => s,n,Playback(mudo_desabilitado)
; ==== RETORNA SALA
exten => s,n,Goto(retorna-sala,s,1)


; ==== CASO NÃO ESTEJA ADICIONA
exten => s,n(habilitar_mudo),NoOp(HABILITAR MUDO)
exten => s,n,AGI(insere_mudo_usuario.py,${CALLERID(num)},${PIN})
; ==== PEGA SALA E CANAL
exten => s,n,AGI(consulta_sala.py,${CALLERID(num)},${PIN})
exten => s,n,AGI(retorna_canal.py,${CALLERID(num)},${PIN})
; ==== ATIVA MUDO NO CONFBRIDGE
exten => s,n,AGI(muta_canal.py,${SALA_ATUAL},${CANAL})
; ==== PLAYBACK
exten => s,n,Playback(mudo_habilitado)
; ==== RETORNA SALA
exten => s,n,Goto(retorna-sala,s,1)



;----OPÇÃO 6-------------------------------------------------------------------------------
[trocar-sala]
exten => s,1,NoOp(TROCAR DE SALA)
exten => s,n,Background(menu_mudar_sala)
exten => s,n,WaitExten(5)


; ==== SELECIONAR SALA
exten => 1,1,NoOp(SELECIONAR SALA)
exten => 1,n,Read(SALA_DIGITADA,,4)
exten => 1,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => 1,n,AGI(insere_sistema.py,${CALLERID(num)},${PIN})
exten => 1,n,Set(SALA=${SALA_DIGITADA})
exten => 1,n,AGI(insere_banco_sala.py,${CALLERID(num)},${PIN},${SALA},${CHANNEL})
exten => 1,n,Goto(verifica-mudo-supervisor,s,1)

; ==== PROXIMA SALA
exten => 2,1,NoOp(PROXIMA SALA)
exten => 2,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => 2,n,AGI(insere_sistema.py,${CALLERID(num)},${PIN})
exten => 2,n,AGI(consulta_sala.py,${CALLERID(num)},${PIN})
exten => 2,n,AGI(proxima_sala.py,${SALA_ATUAL})
exten => 2,n,AGI(insere_banco_sala.py,${CALLERID(num)},${PIN},${PROXIMA_SALA},${CHANNEL})
exten => 2,n,Goto(verifica-mudo-supervisor,s,1)



; ==== SALA ALEATORIA
exten => 3,1,NoOp(SELECIONAR SALA ALEATORIA)
exten => 3,n,AGI(numero_para_pin.py,${CALLERID(num)})
exten => 3,n,AGI(insere_sistema.py,${CALLERID(num)},${PIN})
exten => 3,n,AGI(sala_sorteada.py)
exten => 3,n,AGI(insere_banco_sala.py,${CALLERID(num)},${PIN},${SALA_SORTEADA},${CHANNEL})
exten => 3,n,Goto(verifica-mudo-supervisor,s,1)


; ==== VOLTAR A SALA
exten => 0,1,NoOp(VOLTAR PARA SALA)
exten => 0,n,Goto(retorna-sala,s,1)


;----OPÇÃO 7-------------------------------------------------------------------------------
; Assionar Monitoria

;----OPÇÃO 8-------------------------------------------------------------------------------
; Menu do proprietario da sala restrita

;----OPÇÃO 9-------------------------------------------------------------------------------


;----OPÇÃO 0-------------------------------------------------------------------------------
; Ouvir menu

;----MENU SUPERVISOR-----------------------------------------------------------------------


;----MENU ADMINISTRADOR--------------------------------------------------------------------
